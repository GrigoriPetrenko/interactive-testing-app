{% extends "base.html" %}

{% block title %}Taking Test - Interactive Testing Application{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-8 mx-auto">
        <!-- Progress Bar -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="mb-0">Question {{ progress }} of {{ total }}</h5>
                    <span class="badge bg-primary">{{ ((progress / total) * 100)|round(1) }}% Complete</span>
                </div>
                <div class="progress" style="height: 10px;">
                    <div class="progress-bar bg-primary" role="progressbar" 
                         style="width: {{ (progress / total) * 100 }}%" 
                         aria-valuenow="{{ progress }}" 
                         aria-valuemin="0" 
                         aria-valuemax="{{ total }}">
                    </div>
                </div>
            </div>
        </div>

        <!-- Question Card -->
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <div class="d-flex justify-content-between align-items-center">
                    <h4 class="mb-0">
                        <i class="fas fa-question-circle me-2"></i>
                        Question {{ progress }}
                    </h4>
                    <div>
                        <span class="badge bg-light text-dark me-2">{{ question.category }}</span>
                        <span class="badge bg-warning text-dark">{{ question.points }} points</span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <h5 class="question-text mb-4">{{ question.question }}</h5>

                <form method="POST" action="{{ url_for('submit_answer') }}">
                    {% if question.type == 'multiple_choice' %}
                        <div class="options-container">
                            {% for option in question.options %}
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="answer" 
                                       id="option{{ loop.index }}" value="{{ loop.index }}">
                                <label class="form-check-label" for="option{{ loop.index }}">
                                    {{ option }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>

                    {% elif question.type == 'true_false' %}
                        <div class="options-container">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="answer" 
                                       id="true" value="true">
                                <label class="form-check-label" for="true">
                                    <i class="fas fa-check text-success me-2"></i>True
                                </label>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="answer" 
                                       id="false" value="false">
                                <label class="form-check-label" for="false">
                                    <i class="fas fa-times text-danger me-2"></i>False
                                </label>
                            </div>
                        </div>

                    {% elif question.type == 'fill_blank' %}
                        <div class="mb-3">
                            <label for="answer" class="form-label">Your Answer:</label>
                            <input type="text" class="form-control form-control-lg" 
                                   id="answer" name="answer" 
                                   placeholder="Enter the missing word or phrase" required>
                        </div>

                    {% elif question.type == 'short_answer' %}
                        <div class="mb-3">
                            <label for="answer" class="form-label">Your Answer:</label>
                            <textarea class="form-control" id="answer" name="answer" 
                                      rows="3" placeholder="Enter your answer" required></textarea>
                        </div>
                    {% endif %}

                    <div class="d-flex justify-content-between mt-4">
                        <button type="button" class="btn btn-outline-secondary" onclick="skipQuestion()">
                            <i class="fas fa-forward me-2"></i>Skip
                        </button>
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-arrow-right me-2"></i>Submit Answer
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Test Controls -->
        <div class="card mt-4">
            <div class="card-body text-center">
                <button type="button" class="btn btn-outline-danger" onclick="confirmExit()">
                    <i class="fas fa-times me-2"></i>Exit Test
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Exit Confirmation Modal -->
<div class="modal fade" id="exitModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Exit Test</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to exit the test? Your progress will be lost.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" onclick="exitTest()">Exit Test</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function skipQuestion() {
    if (confirm('Are you sure you want to skip this question?')) {
        // Submit empty answer to skip
        const form = document.querySelector('form');
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = 'answer';
        input.value = '';
        form.appendChild(input);
        form.submit();
    }
}

function confirmExit() {
    const modal = new bootstrap.Modal(document.getElementById('exitModal'));
    modal.show();
}

function exitTest() {
    window.location.href = "{{ url_for('index') }}";
}

// Auto-focus on first input
document.addEventListener('DOMContentLoaded', function() {
    const firstInput = document.querySelector('input[type="radio"], input[type="text"], textarea');
    if (firstInput) {
        firstInput.focus();
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    // Enter key to submit (except for textarea)
    if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
        e.preventDefault();
        const submitBtn = document.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.click();
        }
    }
    
    // Escape key to show exit modal
    if (e.key === 'Escape') {
        confirmExit();
    }
});
</script>
{% endblock %}

